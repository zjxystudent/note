## 奇妙的扁平树状结构

-   我们平时见到的树状结构一般都是这样的，每层数组中的`item`都会有一个`children`，里面嵌套一个数组然后每个子`item`也还会有各自的`children`，就这样一直嵌套下去。
-   而拍扁后的树状结构其实是一个对象，每个`item`都扁平化平铺在第一层，每一个`item`都有各自的`parentId`与`childrenIds`。

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b5ed132d6a43427b954018496908ba34~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

## 有什么不同

### 父节点

-   在第一种结构中其实没有专门的根节点，在最外层的数组中每一项都是第一层级的父节点。
-   而在第二种结构中一般都会有一个`item`专门来表示**根节点**，就比如这个对象第一行`id`为`root`的`item`。

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6063b774efd448d3b11525e50eb4b452~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

### 子节点

-   在第一种结构中我们的子节点都是在父节点的`children`数组下的每一项，而每一项还会有各自的子节点存在于对应的`children`中。
-   而在第二种结构中每一项都可以当成是子节点，他们各自都拥有一个`parentId`，而**根节点**的`parentId`为空代表它没有父节点，他们的各自的`childrenIds`存储了他们各自`item`的子节点`id`。

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a575cc04b6644508881411b5e9ed4c1a~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

### 渲染

-   就拿`react`来举例，我们一般渲染一个列表都是通过`map`进行遍历渲染，拿到对应的`item`通过`itemRender()`来处理对应的`ReactNode`，在渲染中其实两种状态的使用相差不大。

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3c62f1ab4c604b33b66766409e3d3d8d~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

### 添加

-   在数组对象形式中我们需要给一个父节点添加一个子节点我们首先需要拿到这个父节点的`key`，然后对整个数组结构进行遍历查找来找到对应的`item`拎出来`push`进他的`children`中,然后需要重新构造一个新的数组对象。
-   由于实在是太麻烦了我就列了大概思路，相信大家都会，我们会发现非常繁琐，接下来我会着重讲一下`Map`形式。

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/571bcc850fa648b2ad5dce9659d65457~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

-   而在`Map`形式中我们不需要递归循环遍历整课树，可以发现，在整个结构中数据的表现是非常清晰的，每个`item`都是一样的。
-   我们首先在`Map`新增一条子项数据，直接放在数据结构末尾即可，然后我们再给对应的`父节点`的`childrenIds`中`push`这个子项的`id`即可。
-   和上面那种形式对比感觉如何呢，我个人感觉是方便太多了。

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/044639baa234435f8b2529f649ecef8b~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

### 修改

-   在数组对象形式中我们想修改某一个节点的`title`的时候，我们需要根据`key`遍历找出这个节点然后修改最后构造新的数组结构。
-   而在`Map`形式我们拿到想修改的`id`后就可以直接修改。

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/abda90fa12054385b9039589b4eedd5f~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

### 删除

-   在数组对象形式中我们需要删除一个节点的时候,还是很繁琐，先遍历再删除构造新的数组，想想都已经很麻烦了。
-   而在`Map`形式中我们直接`delete`对应`id`的项即可，如果该项有父节点，我们可以在对应`parentId`项中的`childrenIds`移除对应的`id`即可。

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dda3ef1ab0494929a35592a2c7e7d830~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

## 写在最后

-   我们可以发现将整个结构扁平化后收益特别多。
    -   结构很清晰，我们可以很**轻易**的对数据进行**处理**。
    -   特别是在特别大数据量的情况下，这种形式可以极大的**提高性能**，减去需要遍历的性能消耗。
    -   以前各种在数组对象出现的弊端都消失了。

  

作者：快跑啊小卢_  
链接：https://juejin.cn/post/7142649750402121742  
来源：稀土掘金  
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。