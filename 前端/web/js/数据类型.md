# array
## éå†
<https://juejin.cn/post/7196668320077250616>
ä¸æ”¹å˜åŸæ•°ç»„
- every()ï¼šå¯¹æ•°ç»„æ¯ä¸€é¡¹éƒ½è¿è¡Œä¼ å…¥çš„å‡½æ•°ï¼Œå¦‚æœå¯¹æ¯ä¸€é¡¹å‡½æ•°éƒ½è¿”å› trueï¼Œåˆ™è¿™ä¸ªæ–¹æ³•è¿”å› trueã€‚

- filter()ï¼šå¯¹æ•°ç»„æ¯ä¸€é¡¹éƒ½è¿è¡Œä¼ å…¥çš„å‡½æ•°ï¼Œå‡½æ•°è¿”å› true çš„é¡¹ä¼šç»„æˆæ•°ç»„ä¹‹åè¿”å›ã€‚

- forEach()ï¼šå¯¹æ•°ç»„æ¯ä¸€é¡¹éƒ½è¿è¡Œä¼ å…¥çš„å‡½æ•°ï¼Œæ²¡æœ‰è¿”å›å€¼ã€‚

- map()ï¼šå¯¹æ•°ç»„æ¯ä¸€é¡¹éƒ½è¿è¡Œä¼ å…¥çš„å‡½æ•°ï¼Œè¿”å›ç”±æ¯æ¬¡å‡½æ•°è°ƒç”¨çš„ç»“æœæ„æˆçš„æ•°ç»„ã€‚
 - map(Number):å°†å€¼ä»¥æ•°ç»„çš„æ ¼å¼è¿”å›

- some()ï¼šå¯¹æ•°ç»„æ¯ä¸€é¡¹éƒ½è¿è¡Œä¼ å…¥çš„å‡½æ•°ï¼Œå¦‚æœæœ‰ä¸€é¡¹å‡½æ•°è¿”å› trueï¼Œåˆ™è¿™ä¸ªæ–¹æ³•è¿”å› trueã€‚

### for in
è·å–å±æ€§(å¯¹è±¡è·å–å±æ€§ï¼Œæ•°ç»„æ‰¾ä¸åˆ°å±æ€§ï¼Œè¿”å›ä¸‹æ ‡)
### for of
è·å–å€¼

# date
`Date` ç±»å‹å°†æ—¥æœŸä¿å­˜ä¸ºè‡ªåè°ƒä¸–ç•Œæ—¶ï¼ˆUTCï¼ŒUniversal Time Coordinatedï¼‰æ—¶é—´ 1970 å¹´ 1 æœˆ 1 æ—¥åˆå¤œï¼ˆé›¶æ—¶ï¼‰è‡³ä»Šæ‰€ç»è¿‡çš„æ¯«ç§’æ•°ã€‚ä½¿ç”¨è¿™ç§å­˜å‚¨æ ¼å¼ï¼ŒDate ç±»å‹å¯ä»¥ç²¾ç¡®è¡¨ç¤º 1970 å¹´ 1 æœˆ 1 æ—¥ä¹‹å‰åŠä¹‹å 285 616 å¹´çš„æ—¥æœŸã€‚

## åˆ›å»ºå¯¹è±¡ Date()

è¦åˆ›å»ºæ—¥æœŸå¯¹è±¡ï¼Œå°±ä½¿ç”¨ new æ“ä½œç¬¦æ¥è°ƒç”¨ Date æ„é€ å‡½æ•°ï¼š
```js
let now = new Date(); 
```
Date æ„é€ å‡½æ•°çš„å‚æ•°ä¸ºç©ºæ—¶ï¼Œåˆ›å»ºçš„å¯¹è±¡å°†ä¿å­˜å½“å‰æ—¥æœŸå’Œæ—¶é—´ã€‚è¦åŸºäºå…¶ä»–æ—¥æœŸå’Œæ—¶
é—´åˆ›å»ºæ—¥æœŸå¯¹è±¡ï¼Œå¿…é¡»ä¼ å…¥å…¶æ¯«ç§’è¡¨ç¤ºï¼ˆUNIX çºªå…ƒ 1970 å¹´ 1 æœˆ 1 æ—¥åˆå¤œä¹‹åçš„æ¯«ç§’æ•°ï¼‰ã€‚

ECMAScriptä¸ºæ­¤æä¾›äº†ä¸¤ä¸ªè¾…åŠ©æ–¹æ³•ï¼š`Date.parse()`å’Œ `Date.UTC()`ã€‚

## è¿”å›æ—¥æœŸçš„æ¯«ç§’è¡¨ç¤º 

Date.parse()

`Date.parse()`æ¥æ”¶ä¸€ä¸ªè¡¨ç¤ºæ—¥æœŸçš„å­—ç¬¦ä¸²å‚æ•°ï¼Œå°è¯•å°†è¿™ä¸ªå­—ç¬¦ä¸²è½¬æ¢ä¸ºè¡¨ç¤ºè¯¥æ—¥æœŸçš„æ¯«ç§’æ•°ã€‚ECMA-262 ç¬¬ 5 ç‰ˆå®šä¹‰äº† Date.parse()åº”è¯¥æ”¯æŒçš„æ—¥æœŸæ ¼å¼ï¼Œå¡«å……äº†ç¬¬ 3 ç‰ˆé—ç•™çš„ç©ºç™½ã€‚æ‰€æœ‰å®ç°éƒ½å¿…é¡»æ”¯æŒä¸‹åˆ—æ—¥æœŸæ ¼å¼ï¼š

- â€œæœˆ/æ—¥/å¹´â€ï¼Œå¦‚"5/23/2019"ï¼›
- â€œæœˆå æ—¥, å¹´â€ï¼Œå¦‚"May 23, 2019"ï¼›
- â€œå‘¨å‡  æœˆå æ—¥ å¹´ æ—¶:åˆ†:ç§’ æ—¶åŒºâ€ï¼Œå¦‚"Tue May 23 2019 00:00:00 GMT-0700"ï¼›
-  ISO 8601 æ‰©å±•æ ¼å¼â€œYYYY-MM-DDTHH:mm:ss.sssZâ€ï¼Œå¦‚ 2019-05-23T00:00:00ï¼ˆåªé€‚ç”¨äº
å…¼å®¹ ES5 çš„å®ç°ï¼‰ã€‚

æ¯”å¦‚ï¼Œè¦åˆ›å»ºä¸€ä¸ªè¡¨ç¤ºâ€œ2019 å¹´ 5 æœˆ 23 æ—¥â€çš„æ—¥æœŸå¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç ï¼š
```js
let someDate = new Date(Date.parse("May 23, 2019")); 
```
å¦‚æœä¼ ç»™ Date.parse()çš„å­—ç¬¦ä¸²å¹¶ä¸è¡¨ç¤ºæ—¥æœŸï¼Œåˆ™è¯¥æ–¹æ³•ä¼šè¿”å› NaNã€‚å¦‚æœç›´æ¥æŠŠè¡¨ç¤ºæ—¥æœŸçš„å­—
ç¬¦ä¸²ä¼ ç»™ Date æ„é€ å‡½æ•°ï¼Œé‚£ä¹ˆ Date ä¼šåœ¨åå°è°ƒç”¨ Date.parse()ã€‚

æ¢å¥è¯è¯´ï¼Œä¸‹é¢è¿™è¡Œä»£ç è·Ÿå‰é¢é‚£è¡Œä»£ç æ˜¯ç­‰ä»·çš„ï¼š`let someDate = new Date("May 23, 2019")`; 

è¿™ä¸¤è¡Œä»£ç å¾—åˆ°çš„æ—¥æœŸå¯¹è±¡ç›¸åŒã€‚

>æ³¨æ„ ä¸åŒçš„æµè§ˆå™¨å¯¹ Date ç±»å‹çš„å®ç°æœ‰å¾ˆå¤šé—®é¢˜ã€‚æ¯”å¦‚ï¼Œå¾ˆå¤šæµè§ˆå™¨ä¼šé€‰æ‹©ç”¨å½“å‰æ—¥æœŸæ›¿ä»£è¶Šç•Œçš„æ—¥æœŸï¼Œå› æ­¤æœ‰äº›æµè§ˆå™¨ä¼šå°†"January 32, 2019"è§£é‡Šä¸º"February 1, 2019"ã€‚Opera åˆ™ä¼šæ’å…¥å½“å‰æœˆçš„å½“å‰æ—¥ï¼Œè¿”å›"January å½“å‰æ—¥, 2019"ã€‚å°±æ˜¯è¯´ï¼Œå¦‚æœæ˜¯åœ¨ 9 æœˆ 21 æ—¥è¿è¡Œä»£ç ï¼Œä¼šè¿”å›"January 21, 2019"ã€‚

`Date.UTC()`ä¹Ÿè¿”å›æ—¥æœŸçš„æ¯«ç§’è¡¨ç¤ºï¼Œä½†ä½¿ç”¨çš„æ˜¯è·Ÿ Date.parse()ä¸åŒçš„ä¿¡æ¯æ¥ç”Ÿæˆè¿™ä¸ªå€¼ã€‚
ä¼ ç»™ Date.UTC()çš„å‚æ•°æ˜¯å¹´ã€é›¶èµ·ç‚¹æœˆæ•°ï¼ˆ1 æœˆæ˜¯ 0ï¼Œ2 æœˆæ˜¯ 1ï¼Œä»¥æ­¤ç±»æ¨ï¼‰ã€æ—¥ï¼ˆ1~31ï¼‰ã€æ—¶ï¼ˆ0~23ï¼‰ã€åˆ†ã€ç§’å’Œæ¯«ç§’ã€‚è¿™äº›å‚æ•°ä¸­ï¼Œåªæœ‰å‰ä¸¤ä¸ªï¼ˆå¹´å’Œæœˆï¼‰æ˜¯å¿…éœ€çš„ã€‚å¦‚æœä¸æä¾›æ—¥ï¼Œé‚£ä¹ˆé»˜è®¤ä¸º 1 æ—¥ã€‚å…¶ä»–å‚æ•°çš„é»˜è®¤å€¼éƒ½æ˜¯ 0ã€‚

ä¸‹é¢æ˜¯ä½¿ç”¨ Date.UTC()çš„ä¸¤ä¸ªä¾‹å­ï¼š
```js
// GMT æ—¶é—´ 2000 å¹´ 1 æœˆ 1 æ—¥é›¶ç‚¹
let y2k = new Date(Date.UTC(2000, 0)); 
// GMT æ—¶é—´ 2005 å¹´ 5 æœˆ 5 æ—¥ä¸‹åˆ 5 ç‚¹ 55 åˆ† 55 ç§’
let allFives = new Date(Date.UTC(2005, 4, 5, 17, 55, 55)); 
```
è¿™ä¸ªä¾‹å­åˆ›å»ºäº†ä¸¤ä¸ªæ—¥æœŸ ã€‚

ç¬¬ä¸€ä¸ªæ—¥æœŸæ˜¯ 2000 å¹´ 1 æœˆ 1 æ—¥é›¶ç‚¹ï¼ˆGMTï¼‰ï¼Œ2000 ä»£è¡¨å¹´ï¼Œ0 ä»£è¡¨æœˆ
ï¼ˆ1 æœˆï¼‰ã€‚å› ä¸ºæ²¡æœ‰å…¶ä»–å‚æ•°ï¼ˆæ—¥å– 1ï¼Œå…¶ä»–å– 0ï¼‰ï¼Œæ‰€ä»¥ç»“æœå°±æ˜¯è¯¥æœˆç¬¬ 1 å¤©é›¶ç‚¹ã€‚

ç¬¬äºŒä¸ªæ—¥æœŸè¡¨ç¤º 2005
å¹´ 5 æœˆ 5 æ—¥ä¸‹åˆ 5 ç‚¹ 55 åˆ† 55 ç§’ï¼ˆGMTï¼‰ã€‚è™½ç„¶æ—¥æœŸé‡Œé¢æ¶‰åŠçš„éƒ½æ˜¯ 5ï¼Œä½†æœˆæ•°å¿…é¡»ç”¨ 4ï¼Œå› ä¸ºæœˆæ•°æ˜¯é›¶
èµ·ç‚¹çš„ã€‚å°æ—¶ä¹Ÿå¿…é¡»æ˜¯ 17ï¼Œå› ä¸ºè¿™é‡Œé‡‡ç”¨çš„æ˜¯ 24 å°æ—¶åˆ¶ï¼Œå³å–å€¼èŒƒå›´æ˜¯ 0~23ã€‚å…¶ä»–å‚æ•°å°±éƒ½å¾ˆç›´è§‚äº†ã€‚

ä¸ Date.parse()ä¸€æ ·ï¼ŒDate.UTC()ä¹Ÿä¼šè¢« Date æ„é€ å‡½æ•°éšå¼è°ƒç”¨ï¼Œä½†æœ‰ä¸€ä¸ªåŒºåˆ«ï¼šè¿™ç§æƒ…å†µ
ä¸‹åˆ›å»ºçš„æ˜¯æœ¬åœ°æ—¥æœŸï¼Œä¸æ˜¯ GMT æ—¥æœŸã€‚

ä¸è¿‡ Date æ„é€ å‡½æ•°è·Ÿ Date.UTC()æ¥æ”¶çš„å‚æ•°æ˜¯ä¸€æ ·çš„ã€‚å› æ­¤ï¼Œå¦‚æœç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ•°å€¼ï¼Œåˆ™æ„é€ å‡½æ•°å‡è®¾å®ƒæ˜¯æ—¥æœŸä¸­çš„å¹´ï¼Œç¬¬äºŒä¸ªå‚æ•°å°±æ˜¯æœˆï¼Œä»¥æ­¤ç±»æ¨ã€‚å‰é¢çš„
ä¾‹å­ä¹Ÿå¯ä»¥è¿™æ ·æ¥å†™ï¼š
```js
// æœ¬åœ°æ—¶é—´ 2000 å¹´ 1 æœˆ 1 æ—¥é›¶ç‚¹
let y2k = new Date(2000, 0); 
// æœ¬åœ°æ—¶é—´ 2005 å¹´ 5 æœˆ 5 æ—¥ä¸‹åˆ 5 ç‚¹ 55 åˆ† 55 ç§’
let allFives = new Date(2005, 4, 5, 17, 55, 55); 
```
ä»¥ä¸Šä»£ç åˆ›å»ºäº†ä¸å‰é¢ä¾‹å­ä¸­ç›¸åŒçš„ä¸¤ä¸ªæ—¥æœŸï¼Œä½†è¿™æ¬¡çš„ä¸¤ä¸ªæ—¥æœŸæ˜¯ï¼ˆç”±äºç³»ç»Ÿè®¾ç½®å†³å®šçš„ï¼‰æœ¬åœ°
æ—¶åŒºçš„æ—¥æœŸã€‚
ECMAScript è¿˜æä¾›äº† Date.now()æ–¹æ³•ï¼Œè¿”å›è¡¨ç¤ºæ–¹æ³•æ‰§è¡Œæ—¶æ—¥æœŸå’Œæ—¶é—´çš„æ¯«ç§’æ•°ã€‚è¿™ä¸ªæ–¹æ³•å¯
ä»¥æ–¹ä¾¿åœ°ç”¨åœ¨ä»£ç åˆ†æä¸­ï¼š
// èµ·å§‹æ—¶é—´
let start = Date.now(); 
// è°ƒç”¨å‡½æ•°
doSomething(); 
// ç»“æŸæ—¶é—´
let stop = Date.now(), 
result = stop - start;

> ## æœˆä»½åŠ ä¸€
> ```js
> console.log(+new Date(2000,1,1))
>//949334400000 æ—¶é—´æˆ³è½¬ 2000ï¼Œ2ï¼Œ1
>```

# Set

## æ–¹æ³•

### forEach

åœ¨è°ƒç”¨forEach éå†Seté›†åˆæ—¶ï¼Œå¦‚æœä¸€ä¸ªå€¼å·²ç»è¢«è®¿é—®è¿‡äº†ï¼Œä½†æ”¹åˆ¶è¢«åˆ é™¤å¹¶é‡æ–°æ·»åŠ åˆ°é›†åˆï¼Œå¦‚æœæ­¤æ¬¡éå†æ²¡æœ‰ç»“æŸï¼Œè¯¥å€¼ä¼šè¢«é‡æ–°è®¿é—®ã€‚

# Map

Mapä¿å­˜é”®å€¼å¯¹ï¼Œå¹¶è®°ä½keyçš„åŸå§‹æ’å…¥é¡ºåº

## Mapå’ŒObjectçš„åŒºåˆ«

### key

- Objectä¸­çš„keyå¿…é¡»æ˜¯**åŸå§‹**æ•°æ®ç±»å‹ã€‚å®ƒä»¬å¯ä»¥æ˜¯å­—ç¬¦ä¸²ï¼Œæ•°å­—ï¼Œç¬¦å·ï¼Œç”šè‡³æ˜¯bigIntã€‚å³ä½¿æ‚¨æ·»åŠ éåŸå§‹keyï¼ˆä¾‹å¦‚Objectæˆ–Arrayï¼‰ï¼Œå®ƒä»¬ä¹Ÿå°†è¢«è½¬æ¢ä¸ºStringã€‚ä½†æ˜¯ï¼Œæ‚¨ä»ç„¶å¯ä»¥æ£€ç´¢å®ƒä»¬ã€‚

- ä½¿ç”¨Mapï¼Œæ‚¨å¯ä»¥å°†ä»»ä½•**æ•°æ®ç±»å‹**ï¼ˆä¾‹å¦‚Objectï¼ŒArrayç­‰ï¼‰ç”¨ä½œkey,å…¶å†…éƒ¨ä½¿ç”¨SameValueZeroæ¯”è¾ƒæ“ä½œï¼Œç­‰åŒä¸ä½¿ç”¨ä¸¥æ ¼å¯¹è±¡ç›¸ç­‰çš„æ ‡å‡†æ¥æ£€æµ‹é”®çš„åŒ¹é…æ€§ã€‚
   
**SameValueZero æ¯”è¾ƒä¹Ÿå¯èƒ½å¯¼è‡´æ„æƒ³ä¸åˆ°çš„å†²çªï¼š**
   
  ```javascript
const m = new Map(); 
const a = 0/"", // NaN 
	  b = 0/"", // NaN 
	  pz = +0,
	  nz = -0; 
	  alert(a === b); // false 
	  alert(pz === nz); // true 
	  m.set(a, "foo"); 
	  m.set(pz, "bar"); 
	  alert(m.get(b)); // foo 
	  alert(m.get(nz)); // bar
```

- å³ä½¿ä½ èƒ½æ·»åŠ ä¸€ä¸ªObjectä½œä¸ºåœ¨ä¸€ä¸ªkeyçš„**Object**ï¼Œä½ åªèƒ½åšä¸€æ¬¡ã€‚å¦‚æœå°†å¤šä¸ªkeyæ·»åŠ ä¸ºObjectï¼Œåˆ™ä»…ä¿ç•™æœ€åä¸€ä¸ªã€‚ä½†æ˜¯å¯¹äº**Map**ï¼Œæƒ…å†µå¹¶éå¦‚æ­¤ã€‚

***SameValueZero** æ˜¯ ECMAScript è§„èŒƒæ–°å¢çš„ç›¸ç­‰æ€§æ¯”è¾ƒç®—æ³•ã€‚å…³äº ECMAScript çš„ç›¸ ç­‰æ€§æ¯”è¾ƒï¼ŒECMAScript è§„èŒƒå†…éƒ¨å®šä¹‰ï¼Œè¯­è¨€ä¸­ä¸èƒ½ä½¿ç”¨å¯ä»¥ï¼Œå‚è€ƒ MDN æ–‡æ¡£ä¸­çš„æ–‡ç« â€œEquality Comparisons and Samenessâ€ã€‚*

### Method

-   å¯¹äºObjectï¼Œå¯ä»¥ä½¿ç”¨æ­¤è¡¨ç¤ºæ³•è®¾ç½®å’Œè·å–å€¼`obj[number]`ï¼Œä½†å¯¹äºMapï¼Œæˆ‘ä»¬åº”ä½¿ç”¨çš„æ–¹æ³•`get(), set(), has()`ç­‰ã€‚æ‚¨å¯ä»¥åœ¨[MDNæ–‡æ¡£ä¸­](https://links.jianshu.com/go?to=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FMap)é˜…è¯»æœ‰å…³è¿™äº›æ–¹æ³•çš„æ›´å¤šä¿¡æ¯ã€‚

- Mapå®ä¾‹ä¼šç»´æŠ¤é”®å€¼å¯¹çš„æ’å…¥é¡ºåºï¼Œå¯ä»¥ æ‰§è¡Œè¿­ä»£æ“ä½œ

## åŸºæœ¬API

### æ„é€ å‡½æ•°

```javascript
//ç©ºæ˜ å°„
const m=new Map();

//ä¼ å…¥å¯è¿­ä»£å¯¹è±¡ï¼ˆåŒ…å«é”®å€¼å¯¹æ•°ç»„ï¼‰åˆå§‹åŒ–
const m1=new Map([
["key1","val1"],
["key2","val2"],
["key3","val3"],
])

// æ˜ å°„æœŸå¾…çš„é”®/å€¼å¯¹ï¼Œæ— è®ºæ˜¯å¦æä¾› 
const m3 = new Map([[]]);
alert(m3.has(undefined)); // true 
alert(m3.get(undefined)); // undefined
```

# WeakMap

WeakMap æ˜¯ Map çš„â€œå…„å¼Ÿâ€ç±»å‹ï¼Œå…¶ API ä¹Ÿæ˜¯ Map çš„å­é›†ã€‚å…¶ä¸­çš„â€œweakâ€ï¼ˆå¼±ï¼‰ï¼Œæè¿°çš„æ˜¯ JavaScript åƒåœ¾å›æ”¶ç¨‹åºå¯¹å¾…â€œå¼±æ˜ å°„â€ä¸­é”®çš„æ–¹å¼ã€‚

WeakMapå¯¹keyæ˜¯å¼±å¼•ç”¨ï¼Œä¸å½±å“åƒåœ¾å›æ”¶çš„å·¥ä½œã€‚ä¸€æ—¦keyè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ï¼Œé‚£ä¹ˆå¯¹åº”çš„é”®å’Œå€¼å°±è®¿é—®ä¸åˆ°äº†ã€‚æ‰€ä»¥WeakMapç»å¸¸ç”¨äºå­˜å‚¨é‚£äº›åªæœ‰å½“keyæ‰€å¼•ç”¨çš„å¯¹è±¡å­˜åœ¨æ—¶ï¼ˆæ²¡æœ‰è¢«å›æ”¶ï¼‰æ‰æœ‰ä»·å€¼çš„ä¿¡æ¯ã€‚ ^354e2c

## å·®å¼‚

-   **å®ƒä»¬åªèƒ½åŒ…å«ä½œä¸ºObjectçš„key**

åŸå§‹æ•°æ®ç±»å‹ä¸å…è®¸ä½œä¸ºkeyã€‚å¦‚æœæ‚¨ä½¿ç”¨åŸå§‹å€¼ï¼Œåˆ™ä¼šå¼•å‘é”™è¯¯`TypeError: Invalid value used as weak map key`ã€‚ä¹‹æ‰€ä»¥åªå…è®¸Objectä½œä¸ºkeyæ˜¯å› ä¸ºä»ä¸å¯¹åŸå§‹å€¼è¿›è¡Œåƒåœ¾å›æ”¶ã€‚å¦‚æœç¡®å®å…è®¸ä½¿ç”¨åŸå§‹å€¼ä½œä¸ºkeyï¼Œé‚£ä¹ˆæ‚¨æ ¹æœ¬ä¸ä¼šä»WeakMapä¸­å—ç›Šã€‚

-   **æ‚¨éœ€è¦çŸ¥é“keyæ‰èƒ½è·å¾—å…¶ä»·å€¼**

ç”±äºå¼•ç”¨Weakï¼Œå› æ­¤WeakMapä¸åŒ…å«å¯è¿­ä»£é¡¹æˆ–è·å–keyåˆ—è¡¨çš„æ–¹æ³•ã€‚æ­¤å¤–ï¼Œæ‚¨ä¹Ÿæ— æ³•è®¿é—®WeakMapçš„å¤§å°ã€‚ç”±äºè¿™äº›å±æ€§ï¼ŒWeakMapæœ‰æ—¶è¢«ç§°ä¸ºé»‘åŒ£å­ã€‚

## å®ä¾‹

### åœ¨Chromeä¸­Mapå’ŒWeakMapå†…å­˜æ¶ˆè€—æƒ…å†µ

```javascript
function Obj(){
    this.val = new Array(10000000).join(",,,");
}

window.obj = new Obj();
let map = new Map();
map.set(window.obj, 1);
//Take a memory snapshot here

// Run the following code after the initial memory snapshot
delete window.obj
1234
//1234 is needed to avoid logging the obj in console
```
![[Chromeä¸­Mapå†…å­˜æ¶ˆè€—æƒ…å†µå›¾.svg]]

***è§£é‡Š** å¦‚æ‚¨åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­çœ‹åˆ°çš„ï¼Œå³ä½¿åœ¨è¿è¡Œ`delete window.obj`è¯¥å˜é‡ä¹‹åï¼Œä¹Ÿå°šæœªå¯¹å…¶è¿›è¡Œåƒåœ¾å›æ”¶ã€‚è¿™æ˜¯å› ä¸ºå³ä½¿åœ¨`obj`ä¸­åˆ é™¤äº†`window`å¯¹çš„å¼•ç”¨ï¼Œä¹Ÿæ²¡æœ‰åˆ é™¤Mapä¸­çš„å¼•ç”¨ã€‚åƒåœ¾å›æ”¶å™¨æ— æ³•é‡Šæ”¾å†…å­˜ï¼Œ`obj`å› ä¸ºMapä¸­ä»ç„¶å­˜åœ¨å¼•ç”¨ã€‚è¦åœ¨Mapä¸­åˆ é™¤å‚è€ƒï¼Œæ‚¨å¿…é¡»ä½¿ç”¨`map.clear()`æˆ–åˆ é™¤key`map.delete(window.obj)`ã€‚è¿™å°†å¯¼è‡´åƒåœ¾å›æ”¶å™¨é‡Šæ”¾å†…å­˜ã€‚*

```javascript
function Obj(){
    this.val = new Array(10000000).join(",,,");
}

window.obj = new Obj();
let map = new WeakMap();
map.set(window.obj, 1);
//Take a memory snapshot here

// Run the following code after the initial memory snapshot
delete window.obj
1234
//1234 is needed to avoid logging the obj in console
```

![[Chromeä¸­WeakMapå†…å­˜æ¶ˆè€—æƒ…å†µå›¾.svg]]
***è§£é‡Š** ä¸Mapç¤ºä¾‹ç›¸åï¼Œåªè¦æ‚¨è¿è¡Œ`delete window.obj`ï¼Œè¯¥å˜é‡å°±ä¼šè¢«åƒåœ¾å›æ”¶ã€‚å½“åœ¨`obj`ä¸­åˆ é™¤å¯¹çš„å¼•ç”¨æ—¶`window`ï¼Œåƒåœ¾å›æ”¶å™¨æœªæ‰¾åˆ°`obj`å¯¹å®ƒçš„å…¶ä»–å¼•ç”¨ï¼Œå› æ­¤é‡Šæ”¾äº†åˆ†é…ç»™å®ƒçš„å†…å­˜ã€‚å³ä½¿æˆ‘ä»¬ç¡®å®æœ‰ä¸€ä¸ªWeakMapå¼•ç”¨äº†`obj`ï¼Œåƒåœ¾å›æ”¶å™¨ä»ç„¶æœ€ç»ˆé‡Šæ”¾äº†å†…å­˜ã€‚è¿™æ˜¯å› ä¸ºå¦‚å‰æ‰€è¿°ï¼ŒWeakMapä¸­çš„å¼•ç”¨æ˜¯â€œ**Weak**â€çš„ã€‚*

### æ·»åŠ å…¶ä»–æ•°æ®

WeakMapå…è®¸æ‚¨å°†å…¶ä»–æ•°æ®æ·»åŠ åˆ°å±äºå¦ä¸€ä¸ªæˆ–ç¬¬ä¸‰æ–¹ä»£ç çš„Objectä¸­ã€‚ä½¿ç”¨WeakMapçš„ç‰¹æ®Šâ€œWeakâ€é“¾æ¥åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®ä¿ä¸è¯¥å¤–æ¥Objectå…³è”çš„æ•°æ®ä»…åœ¨è¯¥Objectå¤„äºæ´»åŠ¨çŠ¶æ€æ—¶æ‰å­˜åœ¨ã€‚

```javascript
weakMap.set(alienObject, "newly found secret about aliens");
// if the alienObject dies, newly found secret about aliens will also be destroyed automatically
```

### ç¼“å­˜æ•°æ®

ä½¿ç”¨WeakMapï¼Œæ‚¨å¯ä»¥å°†å…ˆå‰è®¡ç®—çš„ç»“æœä¸Objectç›¸å…³è”ï¼Œè€Œä¸å¿…æ‹…å¿ƒå†…å­˜ç®¡ç†ã€‚ä»¥ä¸‹ç¤ºä¾‹å°†è®¡ç®—ç»“æœç¼“å­˜åœ¨`cache`WeakMapä¸­ã€‚ä¸€æ—¦å°†Objectä»å¼•ç”¨ä¸­åˆ é™¤ï¼Œåˆ™å†…å­˜ä¹Ÿå°†è¢«é‡Šæ”¾ã€‚

```javascript
// ğŸ“ cache.js
let cache = new WeakMap();
// compute and remember the result
function compute(obj) {
  if (!cache.has(obj)) {
    let result = obj.name + " is " + obj.age + " years old.";
    cache.set(obj, result);
    return [result,'computed'];
  }
return [cache.get(obj),'cached'];
}
// ğŸ“ main.js
let obj = {name:'John',age:16};
let result1 = compute(obj);
let result2 = compute(obj);
console.log(result1);
//["John is 16 years old.", "computed"]
console.log(result2);
//["John is 16 years old.", "cached"]
delete obj;
//Memory is cleared as soon as obj reference is removed
```

# string